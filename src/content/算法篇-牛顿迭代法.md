### 故事的起源——为了彼此相遇
当我们需要求解两条曲线的交点时，会转化为联立两个方程求解。
以解基本椭圆方程为例：
```
x * x / (a1 * a1) + y * y / (b1 * b1) = 1 椭圆方程1
x * x / (a2 * a2) + y * y / (b2 * b2) = 1 椭圆方程2
设 c = (a2 * a2 - a1 * a1) * (b1 * b1 * b2 * b2)/(a2 * a2 * b1 * b1 - a1 * a1 * b2 * b2)；
若 c < 0, 无解
若 c >= 0, 有解
y = Math.sqrt(((a2 * a2 - a1 * a1) * (b1 * b1 * b2 * b2)) / (a2 * a2 * b1 * b1 - a1 * a1 * b2 * b2));
x = Math.sqrt((a1 * a1 * b1 * b1 - a1 * a1 * y * y)/(b1 * b1));
```
最终我们能够得到x和y的表达式，将已经量代入求解，我们可以得到交点的情况。
![image.png](https://cdn.nlark.com/yuque/0/2023/png/34898159/1680247220532-908d8b83-9fb6-4e7c-9f22-10756aa9a968.png#averageHue=%23ededed&clientId=uae31ef11-aec9-4&from=paste&height=353&id=u80affc4f&originHeight=529&originWidth=628&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=30395&status=done&style=none&taskId=u1c7ffbb2-8e6f-4c69-9203-a5430f21927&title=&width=418.6666666666667)
交点可视化
上面的例子我们通过代入消元法得到十分友好的表达式，但在有些情况代入法可能会使问题变得十分复杂。如两带位移和旋转的椭圆相交问题：
![](https://cdn.nlark.com/yuque/0/2023/gif/34898159/1680248412755-28bc8814-9306-4030-b009-d371cab2ed9f.gif#averageHue=%23e8e8e8&clientId=uae31ef11-aec9-4&from=paste&id=uc40a3100&originHeight=24&originWidth=352&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u1d6872cb-3216-4972-a846-1f3ddd6fca2&title=)
联立两个上述方程代入消元，会面临一元四次方程的求解，很难得到最终的表达式。
### 数值解与解析解——当你不再追求完美
在解方程中，我们会考虑数值解或解析解，相关定义如下：
解析解：通过解方程得到的精确解
数值解：通过不断逼近得到的近似解

以求算术平方根为例
题目：给你一个非负整数 x ，计算并返回 x 的 算术平方根 
```javascript
var mySqrt = function(x) {
    let left = 0;
    let right = x;
    let ans = 0;
    while(left<=right){
        const mid = left + Math.floor((right-left)/2);
        if(mid*mid<=x){
            left = mid+1;
            ans = mid;
        }else{
            right = mid-1;
        }
    }
    return ans;
};
```
通过二分法不断地迭代，即使我们没有算术平方根的表达式，也可以得到近似解。
### 更快的结合——有一位媒人叫牛顿
相比于二分法，牛顿迭代法具有更快的迭代速度。
原因是：牛顿迭代法是基于切线逼近求解
还是以求算术平方根为例，求sqrt(x)，为了可视化，我们的目标是用交点呈现要求的解，因此改变一下方程：
y=x^2−c
则当y=0时，c的平方根为方程的解。
从图中可知，方程的解等价于曲线与x轴的交点的x坐标值。

当我们取x=x0，则曲线上的点为（x0，x0^2-c）
根据曲线的斜率方程 f′(x0)=2x0 ，得出与该点相切的直线方程：
y = 2x0(x-x0) + x0^2 -c 
令y=0，得出
x=0.5 * (x0+C/x0)
在图形上表现为垂直于x轴的直线，以该直线与曲线交点再次求切线，不断重复上述过程，逼近交点值。
以下为两次迭代的示意图，当迭代的差距很小时，我们得出近似解。
[https://www.desmos.com/calculator/vj8gyu0lqi](https://www.desmos.com/calculator/vj8gyu0lqi) —— 可以改变数值体验
![1.gif](https://cdn.nlark.com/yuque/0/2023/gif/34898159/1680252838138-52f58b9f-3463-47b3-9595-6febe203faa2.gif#averageHue=%23fbfafa&clientId=uae31ef11-aec9-4&from=paste&height=962&id=u07ea5863&originHeight=1443&originWidth=2547&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1433597&status=done&style=none&taskId=u6892a00d-3eb3-44c3-88a5-9557bebd26e&title=&width=1698)

根据上述思路，我们得出以下求解过程
```javascript
var mySqrt = function(x) {
    if(x === 0){
        return 0;
    }
    let c = x;
    let x0 = x;
    while(true){
        xi = 0.5 * (x0 + c/x0); 
        if(x0-xi < 1e-7){ // 当迭代差距小于阈值，得到目标值
            break;
        }
        x0 = xi;
    }
    return x0;
};
```
当不断迭代过程中，前后两次迭代差距小于阈值（1e-7），则说明我们已经逼近目标值，得出结果。
### 泰勒展开式——当你发现媒人的吸引力
上述求解我们通过图形可视化推导牛顿迭代法。
在数学上，牛顿迭代法的理论基础源于泰勒展开式。
泰勒展开式是用于将复杂函数拆解成无数个简单函数求和的方法。
泰勒展开式的定义如下：设f(x)是一个连续可导函数，x0是它的近似零点，则在x0处的泰勒展开式为：
f(x)=f(x0)+f'(x0)(x-x0)+0.5 * f'(x0)(x-x0)^2+...
我们取一阶泰勒展开，得到
f(x)=f(x0)+f'(x0)(x-x0)
等价于上个例子中的
y = 2x0(x-x0) + x0^2 -c 
其中，2x0为导数f'(x0)，x0^2 -c 为f(x)在x0的值。
因此，牛顿迭代法在可视化中的表现是不断求切线逼近目标值，在数学上是不断地对方程做一阶泰勒展开趋近目标值的方法。
### 求解一元二次方程——换种角度思考人生
我们从数学的角度入手，尝试求解一元二次方程与x轴的交点：
f(x)=x^2-2x-2
首先对方程在x0处做一阶泰勒展开，根据公式：
f(x)=f(x0)+f'(x0)(x-x0)
得到：
f(x) = x0^2-2x0-2 + (2x0-2)(x-x0)
f(x) = 2(x0-1)x - (x0^2 + 2)
令f(x) = 0，求解x，得到：
x = (x0 ^ 2 + 2)/(2(x0 - 1))
我们同样不断迭代，得到近似解，以下为两次迭代的示意图
[https://www.desmos.com/calculator/ie6wag2ry6](https://www.desmos.com/calculator/ie6wag2ry6)
![1.gif](https://cdn.nlark.com/yuque/0/2023/gif/34898159/1680797065037-ff9950d8-3d85-4f9e-9633-9d24561f2d27.gif#averageHue=%23f1f0f0&clientId=u81bdeacb-20e6-4&from=paste&height=962&id=udc4a6cb5&originHeight=1443&originWidth=2547&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=1724207&status=done&style=none&taskId=ue2ac39c8-3fb4-4e5a-99c5-284f4996eaf&title=&width=1698)

在代码层面上，我们替换了新的迭代公式，同时去掉变量c。
```javascript
var solveEquation = function(x) {
    let x0 = x;
    let xi = x;
    while(true){
        xi = (x0 ** 2 + 2)/(2*(x0 - 1)) // 迭代公式
        if(x0-xi < 1e-7){ // 当迭代差距小于阈值，得到目标值
            break;
        }
        x0 = xi;
    }
    return x0;
};
```
当我们取x0为5时，得到的结果为2.732，非常接近图示的结果。
### 求解二元二次方程组
牛顿迭代法的关键是得到迭代公式，对于二元二次方程组，推导过程如下：
设两方程分别为f(x,y)和g(x,y)，在(x0,y0)处一阶泰勒展开：
f(x,y) = f(x0,y0) + fx(x0,y0)(x-x0) + fy(x0,y0)(y-y0)
g(x,y) = g(x0,y0) + gx(x0,y0)(x-x0) + gy(x0,y0)(y-y0)
其中fx，fy，gx，gy分别为对x，y的偏导数。
令f(x,y) = 0，g(x,y) = 0，我们得出迭代公式：
![](https://cdn.nlark.com/yuque/__latex/7f3dbe9ccb1c4a8dd573a5834e580780.svg#card=math&code=x%20%3D%20x0%20%2B%20%5Cfrac%7Bf%28x0%2Cy0%29gy%28x0%2Cy0%29%20-%20g%28x0%2Cy0%29fy%28x0%2Cy0%29%7D%7Bgx%28x0%2Cy0%29fy%28x0%2Cy0%29%20-%20fx%28x0%2Cy0%29gy%28x0%2Cy0%29%7D&id=VGlkJ)
![](https://cdn.nlark.com/yuque/__latex/e483395bc916266b154d2f43786e6bbc.svg#card=math&code=y%20%3D%20y0%20%2B%20%5Cfrac%7Bg%28x0%2Cy0%29fx%28x0%2Cy0%29%20-%20f%28x0%2Cy0%29gx%28x0%2Cy0%29%7D%7Bgx%28x0%2Cy0%29fy%28x0%2Cy0%29%20-%20fx%28x0%2Cy0%29gy%28x0%2Cy0%29%7D&id=HBOHK)
当分母 gx(x0,y0)fy(x0,y0) - fx(x0,y0)gy(x0,y0) != 0时成立。

我们以求解两椭圆相交问题为例，设两椭圆为：
x^2/a1^2 + y^2/b1^2 =1
x^2/a2^2 + y^2/b2^2 =1
我们得到
f(x,y) = x^2/a1^2 + y^2/b1^2 - 1
g(x,y) = x^2/a2^2 + y^2/b2^2 - 1
根据上述迭代方程，我们得到：
![](https://cdn.nlark.com/yuque/__latex/b43ae406214ac89ae23ebc428b97070d.svg#card=math&code=x_%7B1%7D%20%3D%20x_%7B0%7D%20%2B%20%5Cfrac%7B%28%5Cfrac%7Bx_%7B0%7D%5E2%7D%7Ba_%7B1%7D%5E2%7D%20%2B%20%5Cfrac%7By_%7B0%7D%5E2%7D%7Bb_%7B1%7D%5E2%20%7D%20-%201%29%2A%5Cfrac%7B2%20%2Ay_%7B0%7D%7D%7Bb_%7B2%7D%5E2%7D%20-%20%28%5Cfrac%7Bx_%7B0%7D%5E2%7D%7Ba_%7B2%7D%5E2%7D%20%2B%20%5Cfrac%7By_%7B0%7D%5E2%7D%7Bb_%7B2%7D%5E2%7D%20-%201%29%20%2A%20%5Cfrac%7B2%2Ay_%7B0%7D%7D%7Bb_%7B1%7D%5E2%7D%7D%7B%5Cfrac%7B2%20%2A%20x_%7B0%7D%7D%7Ba_%7B2%7D%5E2%7D%20%2A%20%5Cfrac%7B2%20%2A%20y_%7B0%7D%7D%7Bb_%7B1%7D%5E2%7D%20-%20%5Cfrac%7B2%20%2A%20x_%7B0%7D%7D%7Ba_%7B1%7D%5E2%7D%20%2A%20%5Cfrac%7B2%20%2A%20y_%7B0%7D%7D%7Bb_%7B2%7D%20%5E2%7D%7D&id=Fv45u)
![](https://cdn.nlark.com/yuque/__latex/2e541d479c575b484e256cbb628dd35c.svg#card=math&code=y_%7B1%7D%20%3D%20y_%7B0%7D%20%2B%20%5Cfrac%7B%28%5Cfrac%7Bx_%7B0%7D%5E2%7D%7Ba_%7B2%7D%5E2%7D%20%2B%20%5Cfrac%7By_%7B0%7D%5E2%7D%7Bb_%7B2%7D%5E2%20%7D%20-%201%29%2A%5Cfrac%7B2%20%2Ax_%7B0%7D%7D%7Ba_%7B1%7D%5E2%7D%20-%20%28%5Cfrac%7Bx_%7B0%7D%5E2%7D%7Ba_%7B1%7D%5E2%7D%20%2B%20%5Cfrac%7By_%7B0%7D%5E2%7D%7Bb_%7B1%7D%5E2%7D%20-%201%29%20%2A%20%5Cfrac%7B2%2Ax_%7B0%7D%7D%7Ba_%7B2%7D%5E2%7D%7D%7B%5Cfrac%7B2%20%2A%20x_%7B0%7D%7D%7Ba_%7B2%7D%5E2%7D%20%2A%20%5Cfrac%7B2%20%2A%20y_%7B0%7D%7D%7Bb_%7B1%7D%5E2%7D%20-%20%5Cfrac%7B2%20%2A%20x_%7B0%7D%7D%7Ba_%7B1%7D%5E2%7D%20%2A%20%5Cfrac%7B2%20%2A%20y_%7B0%7D%7D%7Bb_%7B2%7D%20%5E2%7D%7D&id=DafLo)
当![](https://cdn.nlark.com/yuque/__latex/311497ca30f0d58d2ada660145ca9ae7.svg#card=math&code=%5Cfrac%7B2%20%2A%20x_%7B0%7D%7D%7Ba_%7B2%7D%5E2%7D%20%2A%20%5Cfrac%7B2%20%2A%20y_%7B0%7D%7D%7Bb_%7B1%7D%5E2%7D%20-%20%5Cfrac%7B2%20%2A%20x_%7B0%7D%7D%7Ba_%7B1%7D%5E2%7D%20%2A%20%5Cfrac%7B2%20%2A%20y_%7B0%7D%7D%7Bb_%7B2%7D%20%5E2%7D&id=Ff3oV)!= 0 时，等式成立

之后不断迭代，知道前后位置距离小于阈值，得出结果。
### 雅可比矩阵与海森矩阵——多元的泰勒展开
一元函数的泰勒展开：
![](https://cdn.nlark.com/yuque/0/2023/svg/34898159/1680747269248-ed2944f1-8ad7-41b7-914a-354b0cf77634.svg#clientId=u0e9a0919-4427-4&from=paste&id=uc765e4e9&originHeight=88&originWidth=395&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u969df749-c949-4ce3-8adf-c45a1dca62e&title=)
二元函数的泰勒展开：
![](https://cdn.nlark.com/yuque/0/2023/svg/34898159/1680747432444-ef3cb457-51bb-4621-83c6-25b8a4cbb451.svg#clientId=u0e9a0919-4427-4&from=paste&id=u58fb650c&originHeight=88&originWidth=686&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u22650534-5540-4d4f-9118-d9f3eba4578&title=)
随着变量及阶数的增加，表达式会越来越长，因此可以改写成矩阵形式简化表达式：
以二元函数的泰勒展开为例：
![](https://cdn.nlark.com/yuque/0/2023/svg/34898159/1680747538630-319332e0-1eab-4a3c-b09d-034a51618097.svg#clientId=u0e9a0919-4427-4&from=paste&id=uaf70c103&originHeight=113&originWidth=485&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u6d4619aa-7a36-4083-b325-569dd4cc81e&title=)
其中一阶偏导数矩阵为雅可比矩阵，二阶偏导数矩阵为海森矩阵。
海森矩阵是方阵，而雅可比矩阵则不一定。

## 参考：
[1] [https://leetcode.cn/problems/sqrtx/description/](https://leetcode.cn/problems/sqrtx/description/)  
[2] [https://wenku.baidu.com/view/cac8012db4daa58da0114ae8.html?_wkts_=1680755886597](https://wenku.baidu.com/view/cac8012db4daa58da0114ae8.html?_wkts_=1680755886597)  
